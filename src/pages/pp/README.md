# 冲压功能模板

## bundle 捆包收获
扫描：
    扫描捆包号，通过工厂+车间+捆包号在板材管理中校验及获取数据
提交：
    提交时判断是否存在移动类型
    提交后更新捆包号的状态、实际收货数、收货时间、收货人信息
    提交后在WM库存表新增库存数据，零件号和箱号都为捆包号

## bundle-list  
弹框显示板材

## change-pieces
用于修改各个功能需要变更的数量

## close-frame  合框
扫描：
1、在料箱管理表中校验二维码信息为料箱编码；
2、料框的状态为：“实框”，零件状态为：“正常”；
3、源料箱和目标料箱的车间一致；
4、判断装箱数是否大于目标料箱最大可装箱数；
提交：
0、判断装箱数是否大于目标料箱最大可装箱数；
1、更新源料框标签、目标料框标签数量，若源料框数量=0，则状态改为“空框”；
2、更新源料框、目标料框的WM库存数据；
3、新增两条出入库记录；

## defective-product  不良品报废
扫描：
      a、在料箱管理表中校验二维码信息为料箱编码
      b、判断该料箱的状态为：“满框”
      c、判断该料箱的车间为PDA配置中的仓库
提交：
      a、按照扫描的判断再判断一次，用于控制多人同时提交相同数据
      b、判断是否存在移动类型，判断逻辑为：工厂+源仓库+单据类型（可疑品）
      c、根据移动类型创建出入库单，并完成。更新零件库存信息。
      d、更新WM库存信息
      e、新增出入库交易信息
      f、更新料箱管理中的数量、最后更新人、最后更新时间，若数量=0，则料框状态改为“空框”

## frame 冲压件装框
2、扫描料框二维码按以下顺序执行程序：
      a、上料口已选择
      b、在料箱管理表中校验二维码信息为料箱编码
      c、判断该料箱的状态为：“空框”
3、获取零件号下拉框数据：根据扫描的料框编码找到在料框管理中找到该编码的料箱类型，根据料箱类型在冲压件数据管理中找到对应的冲压件，若只找到一条数据，则默认该数据；若找到多条数据，关联操作配置管理表中操作类型为“冲压件装框-零件号”的业务数据零件号，关联上的取该零件号，关联不上的，随机默认一条，其他的待选。
4、获取捆包号下拉框数据：扫描料箱标签后，根据选择的上料口，在板材管理中找到使用状态为”使用中“的捆包号，若有多条，随机默认一条，其他的待选。
      4-1、若选择的冲压件类型为“双件双模”，则找捆包号时还需要增加方向去找对应的捆包号。
5、根据捆包号和冲压件下拉框的值增加扫描明细，明细中修改功能中的取值和上述取值一致。
6、提交后按照以下步骤执行程序：
      a、按照扫描的判断再判断一次，用于控制多人同时提交相同数据
      b、判断是否存在移动类型，判断逻辑为：工厂+目标仓库+单据类型（自建）
      c、根据移动类型配置创建对应的出入库单据并完成。完成后更新对应冲压件的零件库存信息
      d、根据冲压件数据管理中的板料用量*装箱数扣减对应捆包号的剩余数量，并将状态改为“使用中”；若捆包号的剩余数量<=0，则将生产状态改为“已用完”。
        d-1、若冲压件类型为“单件双模”，则扣减数量=（板料用量*装箱数）/2
      e、更新料箱管理的信息，关键字段：车间、料框状态（实框）、零件状态（正常）、最后装框人
      f、新增一条WM库存信息
      g、新增一条出入库记录
      h、新增/更新操作配置管理数据：“冲压件装框-零件号”

新增功能：单件双模、双件双模装框模式
1.用户在冲压件中新增维护字段零件组，当零件模式是单件双模、双件双模时该字段必填
2.PDA装框功能，扫描料箱获取零件号后，若是单件双模、双件双模，界面通过零件组展示零件组子零件的信息，若有多个取TOP1；界面参考更新后的原型。
3.选择零件号后，
      a.若零件是单件双模，取当前的捆包号填写到子零件的捆包号中；
      b.若零件是双件双模，取当前零件捆包号下的上料口，找到对应方向的捆包号填写到子零件的捆包号中。
4.再次扫描料箱号，将料箱号填入子零件的料箱信息中；除了要校验料箱的状态为空框外，还需要校验该料框的料框型号和子零件的料箱型号是否一致。
5.提交后两个料箱一起提交。

## pan-dian 盘点料箱

1.盘点单明细页面行明细上增加一个“箱明细按钮”，点击后查询盘点的箱明细，字段为：箱号、系统库存、实盘库存、盘点状态、盘点时间；通过明细表ID和箱明细关联（新增表）
2.创建盘点单时，创建完明细后，还要根据明细去WM库存表关联数据插入到箱明细表
3.PDA功能基于现有盘点功能制作，领取盘点任务后，扫描料箱标签，更新该盘点单下对应明细的料箱盘点数量及盘点状态，同时累计盘点箱数和盘点件数，通过累计实盘件数更新盘点单明细的实盘数
4.盘点完成流程沿用现有功能
5.导入盘点结果页面新增按箱导入盘点结果功能
6.生成冲销单时，若有箱明细数据，则按照箱明细数据生成冲销单
7.盘点差异报表，明细页面增加查看该明细的箱明细差异信息

## panel-feed  板材上料管理
扫描：
      a、扫描二维码时，优先去上料口数据中校验是否是上料口编码，若是，则更新上料口的选项；
      c.判断捆包号车间=PDA配置车间
      b.判断捆包号是否重复扫描
      e.判断捆包号状态为：“已收货”
      f.判断捆包号生产状态为：“未使用”、“被替换”
      f.判断捆包号生产状态不为“已用完”
提交：
      a.判断捆包号生产状态不为“已用完”
      b.更新捆包号的生产状态为“使用中”，更新上料口、更新人、更新时间
      c.若有需要替换的捆包号，则将被替换的捆包号生产状态改为“被替换”，更新人、更新时间
      d.新增/更新操作配置管理数据“板材上料-上料口”、“板材上料-冲压件”

## parts-storage-in 冲压件入库

扫描：
      a、在料箱管理表中校验二维码信息为料箱编码
      b、判断该料箱的状态为：“满框”
      c、判断该料箱的车间为PDA选择的来源仓库（来源仓库可以从操作配置中获取，或者默认一个）
提交：
      a、按照扫描的判断再判断一次，用于控制多人同时提交相同数据
      b、判断是否存在移动类型，判断逻辑为：工厂+源仓库+目标仓库+单据类型（自建）
      c、根据移动类型创建出入库单，并完成。更新零件库存信息。
      d、更新WM库存信息
      e、新增出入库交易信息
      f、更新料箱管理中的车间、最后更新人、最后更新时间
      g、新增/更新操作配置管理数据：“冲压件入库-来源仓库”

## parts-storage-out 冲压件出库
扫描：
      a、在料箱管理表中校验二维码信息为料箱编码
      b、判断该料箱的状态为：“满框”
      c、判断该料箱的车间为PDA配置中的仓库
提交：
      a、按照扫描的判断再判断一次，用于控制多人同时提交相同数据
      b、判断是否存在移动类型，判断逻辑为：工厂+源仓库+目标仓库+单据类型（自建）
      c、根据移动类型创建出入库单，并完成。更新零件库存信息。
      d、更新WM库存信息
      e、新增出入库交易信息
      f、更新料箱管理中的车间、最后更新人、最后更新时间

## receipt-reson 退货原因
 为退货接收页面的退货原因
## receipt-return  退货接收
扫描：
      a、在料箱管理表中校验二维码信息为料箱编码
      b、判断该料箱的状态为：“空框”  
      c、通过料框编码在料框管理中获取上一次装框的零件，添加扫描明细
         c-1、若取不到上一次装框的零件，按照冲压件装箱中查找冲压件的逻辑查询零件号
提交：
      a、按照扫描的判断再判断一次，用于控制多人同时提交相同数据
      b、判断是否存在移动类型，判断逻辑为：工厂+目标仓库+单据类型（自建）
      c、根据移动类型创建出入库单，并完成。更新零件库存信息。
      d、更新WM库存信息
      e、更新料箱管理中的信息

##  return 退货管理 
扫描：
    通过工厂+车间+捆包号在板材管理中校验，判断状态为“已收货”，生产状态为“未使用”，“被替换”
提交：
    提交时判断是否存在移动类型，判断逻辑为：工厂+源仓库+单据类型（自建）。
    提交后更新捆包号的状态（已退货）、最后更新时间、最后更新人信息
    提交后根据移动类型配置创建对应的出入库单据，明细中的零件号和箱号都为捆包号，退货数量为剩余数量,单据状态为完成，但不要增加零件库存信息数据。
    提交后在WM库存表更新对应捆包号的库存数据。
    提交后根据出入库单在出入库交易记录新增交易数据，是否传帐根据移动类型配置控制（传SAP主键字段待确认）
    提交后在退货管理中新增一条退货单数据

## sheet-panel
扫描：捆包号
    工厂+车间+捆包号在板材管理中校验及获取数据
提交：
    3、提交后判断是否存在移动类型，判断逻辑为：工厂+源仓库+目标仓库+单据类型（自建）
    4、提交后更新捆包号的车间、最后更新人、最后更新时间；车间为PDA选择的目标车间
    5、提交后根据移动类型配置创建对应的出入库单据，明细中的零件号和箱号都为捆包号，单据状态为完成，但不要增加零件库存信息数据。
    6、提交后在对应的捆包号WM库存信息进行移库
    7、提交后新增出入库交易记录，是否传帐根据移动类型配置控制

## spare-parts 散件装箱
1.扫描标签时，判断是否是料箱标签，
      a.若是，执行2
      b.若不是，判断是否是唯一标签（预留出支持扫描唯一标签的拓展性，现阶段不做）
2.判断料箱标签是否为实框，
      a.若是实框，则判断料箱的车间和选择的车间是否一致，一致时，通过车间+零件号+库存状态带出散件库存，散件库存零件号不允许修改。
      b.若不是实框，则通过料箱的料箱类型，带出散件库存中可以选择的零件号，用户选择零件号后再带出该零件在车间下的散件库存。
      c.散件库存的装箱数更新逻辑参考合框功能的源料箱里的装箱数逻辑
3.提交后，扣减散件库存，增加目标料箱库存（WM库存、料箱信息），库存状态和散件库存状态保持一致


## suspicious 可疑品管理
扫描：
      a、在料箱管理表中校验二维码信息为料箱编码
      b、判断该料箱的状态为：“实框”  
提交：
      a、按照扫描的判断再判断一次，用于控制多人同时提交相同数据
      b、判断是否存在移动类型，判断逻辑为：
        b-1、若是移入返修区：工厂+源仓库+单据类型（可疑品）
        b-2、若是移出返修区：工厂+目标仓库+单据类型（可疑品）
      c、根据移动类型创建出入库单，并完成。更新零件库存信息。
      d、更新WM库存中的仓库，零件状态等信息
      e、新增出入库交易信息
      f、更新料箱管理中的车间，零件状态等信息

## suspicious-in-out 可疑品装框

所有逻辑参考“冲压件装框”逻辑，唯一的区别在于判断移动类型为：工厂+目标仓库+单据类型（可疑品）

